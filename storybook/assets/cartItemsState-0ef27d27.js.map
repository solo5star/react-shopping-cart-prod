{"version":3,"file":"cartItemsState-0ef27d27.js","sources":["../../src/recoil/effects/localStorageEffect.ts","../../src/api/ClientResponse.ts","../../src/api/utils/PathGenerator.ts","../../src/api/Client.ts","../../src/servers.ts","../../src/recoil/atoms/serverState.ts","../../src/recoil/atoms/clientState.ts","../../src/recoil/queries/cartItemsQuery.ts","../../src/recoil/atoms/syncCartItemState.ts","../../src/recoil/atoms/cartItemsState.ts"],"sourcesContent":["import type { AtomEffect } from 'recoil';\n\nconst localStorageEffect: <T>(key: string) => AtomEffect<T> =\n  (key) =>\n  ({ setSelf, onSet }) => {\n    const savedValue = localStorage.getItem(key);\n    if (savedValue !== null) {\n      setSelf(JSON.parse(savedValue));\n    }\n\n    onSet((newValue, _, isReset) => {\n      if (isReset) {\n        localStorage.removeItem(key);\n        return;\n      }\n      localStorage.setItem(key, JSON.stringify(newValue));\n    });\n  };\n\nexport default localStorageEffect;\n","import type { HttpResponse } from './rest/RestAPI';\n\n// Reference: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status\nconst OK_STATUS_CODES = [\n  200, 201, 202, 203, 204, 205, 206, 207, 208, 226, 300, 301, 302, 303, 304, 307, 308,\n] as const;\n\nclass ClientResponse<TResponse extends HttpResponse> {\n  private readonly responsePromise: Promise<TResponse>;\n\n  constructor(responseFn: () => Promise<TResponse>) {\n    this.responsePromise = responseFn();\n  }\n\n  private assertStatusCode<StatusCode extends TResponse['statusCode']>(\n    response: TResponse,\n    statusCodes: StatusCode | readonly [StatusCode, ...StatusCode[]],\n  ): response is Extract<TResponse, { statusCode: StatusCode }> {\n    return ((Array.isArray(statusCodes) ? statusCodes : [statusCodes]) as number[]).includes(\n      response.statusCode,\n    );\n  }\n\n  async accept<StatusCode extends TResponse['statusCode']>(\n    statusCodes: StatusCode | readonly [StatusCode, ...StatusCode[]],\n  ) {\n    const response = await this.responsePromise;\n    if (!this.assertStatusCode(response, statusCodes)) {\n      return null;\n    }\n    return response;\n  }\n\n  async acceptOrThrow<StatusCode extends TResponse['statusCode']>(\n    statusCodes: StatusCode | readonly [StatusCode, ...StatusCode[]],\n  ) {\n    const response = await this.responsePromise;\n    if (!this.assertStatusCode(response, statusCodes)) {\n      throw new Error(`Server responses with status code ${response.statusCode}`);\n    }\n    return response;\n  }\n\n  async acceptOkOrThrow() {\n    return this.acceptOrThrow(OK_STATUS_CODES);\n  }\n}\n\nexport default ClientResponse;\n","import type { ExtractPathFromRestAPI, RestAPI } from '../rest/RestAPI';\nimport type { HttpMethod } from './http';\n\nclass PathGenerator<\n  TRestAPI extends RestAPI,\n  Method extends HttpMethod,\n  Path extends ExtractPathFromRestAPI<TRestAPI, Method>,\n> {\n  private path: Path;\n\n  internalParams: Extract<TRestAPI['request'], { method: Method; path: Path }>['params'];\n\n  internalQueryParams:\n    | Extract<TRestAPI['request'], { method: Method; path: Path }>['queryParams']\n    | null = null;\n\n  constructor(\n    path: Path,\n    ...params: Extract<TRestAPI['request'], { method: Method; path: Path }>['params']\n  ) {\n    this.path = path;\n    this.internalParams = params;\n  }\n\n  queryParams(queryParams: (typeof this)['internalQueryParams']) {\n    this.internalQueryParams = queryParams;\n    return this;\n  }\n\n  toString(): string {\n    const copiedParams = [...this.internalParams];\n    const path = this.path\n      .split('/')\n      .map((pathToken) => (pathToken.startsWith(':') ? copiedParams.shift() : pathToken))\n      .join('/');\n\n    const queryParams =\n      Object.keys(this.internalQueryParams ?? {}).length === 0\n        ? ''\n        : `?${new URLSearchParams(this.internalQueryParams ?? {}).toString()}`;\n\n    return path + queryParams;\n  }\n}\n\nexport default PathGenerator;\n","// eslint-disable-next-line max-classes-per-file\nimport ClientResponse from './ClientResponse';\nimport type {\n  ExtractBodyFromRestAPI,\n  ExtractPathFromRestAPI,\n  ExtractResponseFromRestAPI,\n  RestAPI,\n} from './rest/RestAPI';\nimport PathGenerator from './utils/PathGenerator';\nimport type { HttpMethod } from './utils/http';\nimport { joinPath } from './utils/http';\n\ntype ClientOptions = {\n  base?: string;\n};\n\nclass Client<TRestAPI extends RestAPI> {\n  constructor(private readonly options: ClientOptions = {}) {}\n\n  private getUrl(path: string) {\n    return joinPath(this.options.base ?? '', path);\n  }\n\n  private async parseResponseData(response: Response) {\n    try {\n      return await response.json();\n    } catch {\n      return null;\n    }\n  }\n\n  toJSON() {\n    return this.options;\n  }\n\n  setBase(base: string) {\n    this.options.base = base;\n  }\n\n  fetch<Method extends TRestAPI['request']['method'], Path extends TRestAPI['request']['path']>(\n    method: Method,\n    path: Path | PathGenerator<TRestAPI, 'GET', Path>,\n    init?: RequestInit,\n  ) {\n    return new ClientResponse<ExtractResponseFromRestAPI<TRestAPI, Method, Path>>(async () => {\n      const response = await fetch(this.getUrl(path.toString()), {\n        method,\n        ...init,\n        headers: {\n          'Content-Type': 'application/json; charset=UTF-8',\n          Authorization: `Basic ${btoa('a@a.com:1234')}`,\n        },\n      });\n\n      return {\n        statusCode: response.status,\n        data: await this.parseResponseData(response),\n        headers: Object.fromEntries(response.headers.entries()),\n      };\n    });\n  }\n\n  get<Path extends ExtractPathFromRestAPI<TRestAPI, 'GET'>>(\n    path: Path | PathGenerator<TRestAPI, 'GET', Path>,\n  ) {\n    return this.fetch('GET', path);\n  }\n\n  post<Path extends ExtractPathFromRestAPI<TRestAPI, 'POST'>>(\n    path: Path | PathGenerator<TRestAPI, 'POST', Path>,\n    body: ExtractBodyFromRestAPI<TRestAPI, 'POST'>,\n  ) {\n    return this.fetch('POST', path, {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(body),\n    });\n  }\n\n  patch<Path extends ExtractPathFromRestAPI<TRestAPI, 'PATCH'>>(\n    path: Path | PathGenerator<TRestAPI, 'PATCH', Path>,\n    body: ExtractBodyFromRestAPI<TRestAPI, 'PATCH'>,\n  ) {\n    return this.fetch('PATCH', path, {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(body),\n    });\n  }\n\n  delete<Path extends ExtractPathFromRestAPI<TRestAPI, 'DELETE'>>(\n    path: Path | PathGenerator<TRestAPI, 'DELETE', Path>,\n  ) {\n    return this.fetch('DELETE', path);\n  }\n\n  path<Method extends HttpMethod, Path extends TRestAPI['request']['path']>(\n    path: Path,\n    ...params: Extract<TRestAPI['request'], { method: Method; path: Path }>['params']\n  ) {\n    return new PathGenerator<TRestAPI, Method, Path>(path, ...params);\n  }\n}\n\nexport default Client;\n","const SERVER_URLS: string = import.meta.env.VITE_SERVER_URLS;\n\nconst SERVER_NAMES = ['주드', '키아라', '히이로'];\n\nexport type Server = {\n  name: string;\n  base: string;\n};\n\nconst servers: Server[] = SERVER_URLS.split(',').map((serverUrl, index) => ({\n  name: SERVER_NAMES[index] ?? `서버-${index + 1}`,\n  base: serverUrl,\n}));\n\nexport default servers;\n","import { atom } from 'recoil';\nimport type { Server } from '../../servers';\nimport servers from '../../servers';\n\nconst serverState = atom<Server>({\n  key: 'serverState',\n  default: servers[0],\n});\n\nexport default serverState;\n","import { selector } from 'recoil';\nimport Client from '../../api/Client';\nimport type { ShoppingCartRestAPI } from '../../api/rest/ShoppingCartRestAPI';\nimport serverState from './serverState';\n\nconst clientState = selector({\n  key: 'clientState',\n  get: ({ get }) => {\n    const server = get(serverState);\n    const client = new Client<ShoppingCartRestAPI>({\n      base: server.base,\n    });\n\n    return client;\n  },\n});\n\nexport default clientState;\n","import { selector } from 'recoil';\nimport type { CartItemEntity } from '../../api/rest/ShoppingCartRestAPI';\nimport clientState from '../atoms/clientState';\n\nconst cartItemsQuery = selector<CartItemEntity[]>({\n  key: 'cartItemsQuery',\n  get: ({ get }) => {\n    const client = get(clientState);\n    return client\n      .get('/cart-items')\n      .acceptOrThrow(200)\n      .then((response) => response.data);\n  },\n});\n\nexport default cartItemsQuery;\n","import { DefaultValue, atomFamily, selectorFamily } from 'recoil';\nimport type Client from '../../api/Client';\nimport type {\n  CartItemEntity,\n  ProductEntity,\n  ShoppingCartRestAPI,\n} from '../../api/rest/ShoppingCartRestAPI';\nimport type { CartItem, Product } from '../../type';\nimport cartItemsQuery from '../queries/cartItemsQuery';\n\ntype SyncCartItemStateKeyEntry = Readonly<{\n  client: Client<ShoppingCartRestAPI>;\n  productId: Product['id'];\n}>;\n\nconst syncCartItemStateKeyEntries: Array<SyncCartItemStateKeyEntry> = [];\n\nexport const syncCartItemStateKey = (\n  client: Client<ShoppingCartRestAPI>,\n  productId: Product['id'],\n) => {\n  const foundEntry =\n    syncCartItemStateKeyEntries.find((it) => it.client === client && it.productId === productId) ??\n    null;\n\n  if (foundEntry == null) {\n    const entry = { client, productId };\n    syncCartItemStateKeyEntries.push(entry);\n    return entry;\n  }\n  return foundEntry;\n};\n\ntype SyncCartItem = {\n  id: CartItemEntity['id'];\n  productId: ProductEntity['id'];\n  quantity: CartItem['quantity'];\n};\n\ntype SyncCartItemState = {\n  client: Client<ShoppingCartRestAPI>;\n  semaphore: Promise<unknown> | null;\n  state: Pick<SyncCartItem, 'productId'> | SyncCartItem;\n  enqueuedUpdates: Array<Partial<SyncCartItem> | null>;\n};\n\nconst syncCartItemState = atomFamily<SyncCartItemState, SyncCartItemStateKeyEntry>({\n  key: 'syncCartItemState',\n  default: selectorFamily({\n    key: 'syncCartItemState/default',\n    get:\n      (entry) =>\n      ({ get }) => {\n        const { client, productId } = entry;\n        const cartItemEntities = get(cartItemsQuery);\n\n        return {\n          client,\n          semaphore: null,\n          state: {\n            productId,\n            ...cartItemEntities.find((cartItemEntity) => cartItemEntity.product.id === productId),\n          },\n          enqueuedUpdates: [],\n        };\n      },\n  }),\n  effects: [\n    ({ setSelf, onSet }) => {\n      const reducer = (syncCartItem: SyncCartItemState): SyncCartItemState => {\n        const { client } = syncCartItem;\n        const path = client.path.bind(client);\n\n        const deleteCartItem = (id: CartItemEntity['id']) => {\n          const semaphore = client.delete(path('/cart-items/:cartItemId', id)).acceptOrThrow(204);\n\n          semaphore.finally(() =>\n            setSelf((syncCartItem) => {\n              if (syncCartItem instanceof DefaultValue) return syncCartItem;\n\n              return reducer({ ...syncCartItem, semaphore: null });\n            }),\n          );\n          return {\n            ...syncCartItem,\n            state: { productId: syncCartItem.state.productId },\n            semaphore,\n            enqueuedUpdates: [],\n          };\n        };\n\n        const createCartItem = () => {\n          const semaphore = client\n            .post('/cart-items', { productId: syncCartItem.state.productId })\n            .acceptOrThrow(201);\n\n          semaphore.then((response) =>\n            setSelf((syncCartItem) => {\n              if (syncCartItem instanceof DefaultValue) return syncCartItem;\n\n              return reducer({\n                ...syncCartItem,\n                state: {\n                  ...syncCartItem.state,\n                  id: Number(\n                    String(response.headers.location)\n                      .match(/(\\d+)$/)\n                      ?.at(0),\n                  ),\n                },\n                semaphore: null,\n              });\n            }),\n          );\n\n          return { ...syncCartItem, semaphore };\n        };\n\n        const updateCartItemQuantity = (id: CartItemEntity['id'], quantity: number) => {\n          const semaphore = client\n            .patch(path('/cart-items/:cartItemId', id), { quantity })\n            .acceptOrThrow(200);\n\n          semaphore.finally(() =>\n            setSelf((syncCartItem) => {\n              if (syncCartItem instanceof DefaultValue) return syncCartItem;\n\n              return reducer({ ...syncCartItem, semaphore: null });\n            }),\n          );\n\n          return {\n            ...syncCartItem,\n            semaphore,\n            state: { ...syncCartItem.state, quantity },\n            enqueuedUpdates: [],\n          };\n        };\n\n        // is update progressing now?\n        if (syncCartItem.semaphore !== null) return syncCartItem;\n\n        // consume actions (merge into final value)\n        const finalState = syncCartItem.enqueuedUpdates.reduce(\n          (currentState, enqueuedUpdate) => ({ ...currentState, ...enqueuedUpdate }),\n          syncCartItem.state,\n        );\n\n        // Deletion\n        const shouldDelete = 'quantity' in finalState && finalState.quantity <= 0;\n        if (shouldDelete) {\n          if ('id' in finalState) return deleteCartItem(finalState.id);\n          return syncCartItem;\n        }\n\n        // Creation: if CartItem.id not exists, create one\n        if (!('quantity' in finalState)) return syncCartItem;\n        const shouldCreate = !('id' in finalState);\n        if (shouldCreate) {\n          return createCartItem();\n        }\n\n        // Update: update quantity\n        if (\n          'quantity' in syncCartItem.state &&\n          syncCartItem.state.quantity === finalState.quantity\n        ) {\n          return syncCartItem;\n        }\n        return updateCartItemQuantity(finalState.id, finalState.quantity);\n      };\n\n      onSet((value) => {\n        const newValue = reducer(value);\n        if (newValue) setSelf(newValue);\n      });\n    },\n  ],\n});\n\nexport default syncCartItemState;\n","/* eslint-disable no-nested-ternary */\nimport { atom, atomFamily, DefaultValue, selector } from 'recoil';\nimport type Client from '../../api/Client';\nimport type { ShoppingCartRestAPI } from '../../api/rest/ShoppingCartRestAPI';\nimport type { CartItem } from '../../type';\nimport localStorageEffect from '../effects/localStorageEffect';\nimport cartItemsQuery from '../queries/cartItemsQuery';\nimport clientState from './clientState';\nimport syncCartItemState, { syncCartItemStateKey } from './syncCartItemState';\n\nconst localCartItemsState = atomFamily<\n  Omit<CartItem, 'unselectedForOrder'>[],\n  Client<ShoppingCartRestAPI>\n>({\n  key: 'localCartItemsState',\n  default: cartItemsQuery,\n});\n\nconst unselectedForOrdersState = atom<Array<CartItem['product']['id']>>({\n  key: 'unselectedForOrdersState',\n  default: [],\n  effects: [localStorageEffect('unselectedForOrders')],\n});\n\nconst cartItemsState = selector<CartItem[]>({\n  key: 'cartItemsState',\n  get: ({ get }) => {\n    const client = get(clientState);\n    const cartItems = get(localCartItemsState(client));\n    const unselectedForOrders = get(unselectedForOrdersState);\n\n    return cartItems.map((cartItem) => ({\n      ...cartItem,\n      unselectedForOrder: unselectedForOrders.includes(cartItem.product.id),\n    }));\n  },\n  set: ({ get, set }, rawNewCartItems) => {\n    const client = get(clientState);\n    const oldCartItems = get(localCartItemsState(client));\n    if (rawNewCartItems instanceof DefaultValue) {\n      throw new Error('reset of cartItemsState is not implemented!');\n    }\n\n    const newCartItems = rawNewCartItems.filter((newCartItem) => newCartItem.quantity > 0);\n\n    // update origin atoms\n    set(localCartItemsState(client), newCartItems);\n    set(\n      unselectedForOrdersState,\n      newCartItems\n        .filter((cartItem) => cartItem.unselectedForOrder)\n        .map((cartItem) => cartItem.product.id),\n    );\n\n    // enqueue update to syncCartItemState\n    const deletedCartItems = oldCartItems.filter(\n      (cartItemEntity) =>\n        newCartItems.find((newCartItem) => newCartItem.product.id === cartItemEntity.product.id) ===\n        undefined,\n    );\n\n    deletedCartItems.forEach((cartItem) => {\n      set(syncCartItemState(syncCartItemStateKey(client, cartItem.product.id)), (syncCartItem) => ({\n        ...syncCartItem,\n        enqueuedUpdates: [...syncCartItem.enqueuedUpdates, { quantity: 0 }],\n      }));\n    });\n\n    newCartItems.forEach((cartItem) => {\n      set(syncCartItemState(syncCartItemStateKey(client, cartItem.product.id)), (syncCartItem) => ({\n        ...syncCartItem,\n        enqueuedUpdates: [...syncCartItem.enqueuedUpdates, { quantity: cartItem.quantity }],\n      }));\n    });\n  },\n});\n\nexport default cartItemsState;\n"],"names":["localStorageEffect","key","setSelf","onSet","savedValue","newValue","_","isReset","OK_STATUS_CODES","ClientResponse","responseFn","response","statusCodes","PathGenerator","path","params","queryParams","copiedParams","pathToken","Client","options","joinPath","base","method","init","body","SERVER_URLS","SERVER_NAMES","servers","serverUrl","index","serverState","atom","clientState","selector","get","server","cartItemsQuery","syncCartItemStateKeyEntries","syncCartItemStateKey","client","productId","foundEntry","it","entry","syncCartItemState","atomFamily","selectorFamily","cartItemEntities","cartItemEntity","reducer","syncCartItem","deleteCartItem","id","semaphore","DefaultValue","createCartItem","_a","updateCartItemQuantity","quantity","finalState","currentState","enqueuedUpdate","value","localCartItemsState","unselectedForOrdersState","cartItemsState","cartItems","unselectedForOrders","cartItem","set","rawNewCartItems","oldCartItems","newCartItems","newCartItem"],"mappings":"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"}
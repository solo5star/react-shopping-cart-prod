{"version":3,"file":"userCartItemsRepository-4c55b0a6.js","sources":["../../src/recoil/repositories/cartItemsRepository.ts","../../src/recoil/user/userCartItemsRepository.ts"],"sourcesContent":["import { selectorFamily } from 'recoil';\nimport type { Client } from '../../api';\nimport type { CartItem } from '../../types/CartItem';\nimport type { Product } from '../../types/Product';\nimport cartItemsState from '../atoms/cartItemsState';\nimport remoteCartItemsStorage from '../storages/remoteCartItemsStorage';\n\ntype CartItemsRepository = {\n  getCartItems(): CartItem[];\n  getCheckedCartItems(): CartItem[];\n  getCartItemByProductId(productId: Product['id']): CartItem | null;\n  addCartItem(cartItem: CartItem): void;\n  addCartItemByProduct(product: Product): void;\n  setQuantity(product: Product, quantity: CartItem['quantity']): void;\n  setChecked(cartItem: CartItem, checked: CartItem['checked']): void;\n  removeCartItem(cartItem: CartItem): void;\n  removeCartItemByProductId(productId: Product['id']): void;\n  removeCheckedCartItem(): void;\n  doDownstreamSync(): void;\n};\n\nconst cartItemsRepository = selectorFamily<CartItemsRepository, Client>({\n  key: 'cartItemsRepository',\n  get:\n    (client) =>\n    ({ get, getCallback }) => {\n      const cartItems = get(cartItemsState(client));\n      const storage = get(remoteCartItemsStorage(client));\n\n      return {\n        getCartItems() {\n          return cartItems;\n        },\n        getCheckedCartItems() {\n          return cartItems.filter((cartItem) => cartItem.checked);\n        },\n        getCartItemByProductId(productId) {\n          return cartItems.find((cartItem) => cartItem.product.id === productId) ?? null;\n        },\n        addCartItem: getCallback(({ set }) => (cartItem) => {\n          set(cartItemsState(client), (cartItems) => [...cartItems, cartItem]);\n        }),\n        addCartItemByProduct: getCallback(({ set }) => (product) => {\n          set(cartItemsState(client), (cartItems) => [\n            ...cartItems,\n            {\n              checked: true,\n              product,\n              quantity: 1,\n            },\n          ]);\n        }),\n        setQuantity: getCallback(({ set }) => (product, quantity) => {\n          set(cartItemsState(client), (cartItems) => {\n            const cartItem =\n              cartItems.find((cartItem) => cartItem.product.id === product.id) ?? null;\n\n            return cartItem === null\n              ? [...cartItems, { product, quantity, checked: true }]\n              : cartItems.map((it) =>\n                  it.product.id === cartItem.product.id ? { ...it, quantity } : it,\n                );\n          });\n        }),\n        setChecked: getCallback(({ set }) => (cartItem, checked) => {\n          set(cartItemsState(client), (cartItems) =>\n            cartItems.map((it) =>\n              it.product.id === cartItem.product.id ? { ...it, checked } : it,\n            ),\n          );\n        }),\n        removeCartItem: getCallback(({ set }) => (cartItem) => {\n          set(cartItemsState(client), (cartItems) =>\n            cartItems.filter((it) => it.product.id !== cartItem.product.id),\n          );\n        }),\n        removeCartItemByProductId: getCallback(({ set }) => (productId) => {\n          set(cartItemsState(client), (cartItems) =>\n            cartItems.filter((cartItem) => cartItem.product.id !== productId),\n          );\n        }),\n        removeCheckedCartItem: getCallback(({ set }) => () => {\n          set(cartItemsState(client), (cartItems) =>\n            cartItems.filter((cartItem) => !cartItem.checked),\n          );\n        }),\n        doDownstreamSync: () => {\n          storage.doDownstreamSync();\n        },\n      };\n    },\n});\n\nexport default cartItemsRepository;\n","import { selector } from 'recoil';\nimport clientState from '../atoms/clientState';\nimport cartItemsRepository from '../repositories/cartItemsRepository';\n\nconst userCartItemsRepository = selector({\n  key: 'userCartItemsRepository',\n  get: ({ get }) => {\n    const client = get(clientState);\n\n    return get(cartItemsRepository(client));\n  },\n});\n\nexport default userCartItemsRepository;\n"],"names":["cartItemsRepository","selectorFamily","client","get","getCallback","cartItems","cartItemsState","storage","remoteCartItemsStorage","cartItem","productId","set","product","quantity","it","checked","userCartItemsRepository","selector","clientState"],"mappings":"oHAqBA,MAAMA,EAAsBC,EAA4C,CACtE,IAAK,sBACL,IACGC,GACD,CAAC,CAAE,IAAAC,EAAK,YAAAC,KAAkB,CACxB,MAAMC,EAAYF,EAAIG,EAAeJ,CAAM,CAAC,EACtCK,EAAUJ,EAAIK,EAAuBN,CAAM,CAAC,EAE3C,MAAA,CACL,cAAe,CACN,OAAAG,CACT,EACA,qBAAsB,CACpB,OAAOA,EAAU,OAAQI,GAAaA,EAAS,OAAO,CACxD,EACA,uBAAuBC,EAAW,CACzB,OAAAL,EAAU,KAAMI,GAAaA,EAAS,QAAQ,KAAOC,CAAS,GAAK,IAC5E,EACA,YAAaN,EAAY,CAAC,CAAE,IAAAO,CAAI,IAAOF,GAAa,CAC9CE,EAAAL,EAAeJ,CAAM,EAAIG,GAAc,CAAC,GAAGA,EAAWI,CAAQ,CAAC,CAAA,CACpE,EACD,qBAAsBL,EAAY,CAAC,CAAE,IAAAO,CAAI,IAAOC,GAAY,CAC1DD,EAAIL,EAAeJ,CAAM,EAAIG,GAAc,CACzC,GAAGA,EACH,CACE,QAAS,GACT,QAAAO,EACA,SAAU,CACZ,CAAA,CACD,CAAA,CACF,EACD,YAAaR,EAAY,CAAC,CAAE,IAAAO,KAAU,CAACC,EAASC,IAAa,CAC3DF,EAAIL,EAAeJ,CAAM,EAAIG,GAAc,CACnC,MAAAI,EACJJ,EAAU,KAAMI,GAAaA,EAAS,QAAQ,KAAOG,EAAQ,EAAE,GAAK,KAEtE,OAAOH,IAAa,KAChB,CAAC,GAAGJ,EAAW,CAAE,QAAAO,EAAS,SAAAC,EAAU,QAAS,GAAM,EACnDR,EAAU,IAAKS,GACbA,EAAG,QAAQ,KAAOL,EAAS,QAAQ,GAAK,CAAE,GAAGK,EAAI,SAAAD,CAAa,EAAAC,CAAA,CAChE,CACL,CAAA,CACF,EACD,WAAYV,EAAY,CAAC,CAAE,IAAAO,KAAU,CAACF,EAAUM,IAAY,CAC1DJ,EAAIL,EAAeJ,CAAM,EAAIG,GAC3BA,EAAU,IAAKS,GACbA,EAAG,QAAQ,KAAOL,EAAS,QAAQ,GAAK,CAAE,GAAGK,EAAI,QAAAC,CAAY,EAAAD,CAC/D,CAAA,CACF,CACD,EACD,eAAgBV,EAAY,CAAC,CAAE,IAAAO,CAAI,IAAOF,GAAa,CACrDE,EAAIL,EAAeJ,CAAM,EAAIG,GAC3BA,EAAU,OAAQS,GAAOA,EAAG,QAAQ,KAAOL,EAAS,QAAQ,EAAE,CAAA,CAChE,CACD,EACD,0BAA2BL,EAAY,CAAC,CAAE,IAAAO,CAAI,IAAOD,GAAc,CACjEC,EAAIL,EAAeJ,CAAM,EAAIG,GAC3BA,EAAU,OAAQI,GAAaA,EAAS,QAAQ,KAAOC,CAAS,CAAA,CAClE,CACD,EACD,sBAAuBN,EAAY,CAAC,CAAE,IAAAO,KAAU,IAAM,CACpDA,EAAIL,EAAeJ,CAAM,EAAIG,GAC3BA,EAAU,OAAQI,GAAa,CAACA,EAAS,OAAO,CAAA,CAClD,CACD,EACD,iBAAkB,IAAM,CACtBF,EAAQ,iBAAiB,CAC3B,CAAA,CAEJ,CACJ,CAAC,ECvFKS,EAA0BC,EAAS,CACvC,IAAK,0BACL,IAAK,CAAC,CAAE,IAAAd,KAAU,CACV,MAAAD,EAASC,EAAIe,CAAW,EAEvB,OAAAf,EAAIH,EAAoBE,CAAM,CAAC,CACxC,CACF,CAAC"}